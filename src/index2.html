<!DOCTYPE html>
<html lang="en">

<head>
    <title>three.js webgl - postprocessing - unreal bloom</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link type="text/css" rel="stylesheet" href="main.css">
    <style>
        #info>* {
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>

<body>

    <div id="container"></div>

    <div id="info">
        <a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> - Bloom pass by <a
            href="http://eduperiment.com" target="_blank" rel="noopener">Prashant Sharma</a> and <a
            href="https://clara.io" target="_blank" rel="noopener">Ben Houston</a>
        <br />
        Model: <a href="https://blog.sketchfab.com/art-spotlight-primary-ion-drive/" target="_blank"
            rel="noopener">Primary Ion Drive</a> by
        <a href="http://mjmurdock.com/" target="_blank" rel="noopener">Mike Murdock</a>, CC Attribution.
    </div>

    <script type="module">

        import * as THREE from './js/threejs/build/three.module.js';

        import Stats from './js/threejs/modules/jsm/libs/stats.module.js';
        import { OrbitControls } from './js/threejs/modules/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from './js/threejs/modules/jsm/loaders/GLTFLoader.js';
        import { RoomEnvironment } from './js/threejs/modules/jsm/environments/RoomEnvironment.js';
        import { EffectComposer } from './js/threejs/modules/jsm/postprocessing/EffectComposer.js';
        import { RenderPass } from './js/threejs/modules/jsm/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from './js/threejs/modules/jsm/postprocessing/UnrealBloomPass.js';

        let camera, stats;
        let composer, renderer, mixer, clock;

        const params = {
            exposure: 1,
            bloomStrength: 2,
            bloomThreshold: 0,
            bloomRadius: 0
        };

        init();

        function init() {

            const container = document.getElementById('container');

            stats = new Stats();
            container.appendChild(stats.dom);

            clock = new THREE.Clock();

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.toneMapping = THREE.ReinhardToneMapping;
            container.appendChild(renderer.domElement);

            const scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 100);
            camera.position.set(- 5, 2.5, - 3.5);
            scene.add(camera);

            const controls = new OrbitControls(camera, renderer.domElement);
            controls.maxPolarAngle = Math.PI * 0.5;
            controls.minDistance = 1;
            controls.maxDistance = 10;

            scene.add(new THREE.AmbientLight(0x404040));

            const pointLight = new THREE.PointLight(0xffffff, 1);
            camera.add(pointLight);

            const renderScene = new RenderPass(scene, camera);

            const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
            bloomPass.threshold = params.bloomThreshold;
            bloomPass.strength = params.bloomStrength;
            bloomPass.radius = params.bloomRadius;

            composer = new EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            new GLTFLoader().load('3d/globe_export.gltf', function (gltf) {

                const model = gltf.scene;
                model.scale.set(0.0001, 0.0001, 0.0001);
                scene.add(model);


                animate();

            });

            window.addEventListener('resize', onWindowResize);

        }

        function onWindowResize() {

            const width = window.innerWidth;
            const height = window.innerHeight;

            camera.aspect = width / height;
            camera.updateProjectionMatrix();

            renderer.setSize(width, height);
            // composer.setSize(width, height);

        }

        function animate() {

            requestAnimationFrame(animate);

            const delta = clock.getDelta();

            // mixer.update(delta);

            stats.update();

            composer.render();

        }

    </script>

</body>

</html>